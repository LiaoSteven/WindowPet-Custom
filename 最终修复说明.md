# ğŸ‰ WindowPet macOS æœ€ç»ˆä¿®å¤è¯´æ˜

## ğŸ“‹ å·²ä¿®å¤çš„é—®é¢˜

### âœ… é—®é¢˜ 1ï¼šmacOS M2 çª—å£åˆ›å»º Bug
**ç—‡çŠ¶**ï¼šåœ¨ MacBook Air M2 ä¸Šæ‰“å¼€æ–°çª—å£å¤±è´¥
**åŸå› **ï¼šä½¿ç”¨ `fullscreen: true` åœ¨ macOS ä¸Šä¼šè¿›å…¥ä¸“ç”¨å…¨å±ç©ºé—´
**ä¿®å¤**ï¼šä½¿ç”¨å¤§å°ºå¯¸çª—å£ (3000x2000) + `maximized` æ¨¡å¼

### âœ… é—®é¢˜ 2ï¼šå® ç‰©è¢«å…¶ä»–çª—å£é®æŒ¡ï¼ˆéƒ¨åˆ†åº”ç”¨ï¼‰
**ç—‡çŠ¶**ï¼šChromeã€Safariã€å¯åŠ¨å°ä¼šé®æŒ¡å® ç‰©
**åŸå› **ï¼šè¿™äº›åº”ç”¨ä½¿ç”¨æ›´é«˜çš„çª—å£å±‚çº§
**ä¿®å¤**ï¼šä½¿ç”¨ macOS åŸç”Ÿ API è®¾ç½®çª—å£å±‚çº§åˆ° `NSScreenSaverWindowLevel`

### âœ… é—®é¢˜ 3ï¼šupdater å¯¼è‡´æ„å»ºå¤±è´¥
**ç—‡çŠ¶**ï¼šæ„å»ºæ—¶æç¤ºç¼ºå°‘ç§é’¥å¯†ç 
**åŸå› **ï¼šè‡ªåŠ¨æ›´æ–°åŠŸèƒ½éœ€è¦ç­¾åå¯†é’¥
**ä¿®å¤**ï¼šç¦ç”¨ updater åŠŸèƒ½

## ğŸ”§ æŠ€æœ¯ä¿®æ”¹

### Rust åç«¯ä¿®æ”¹

1. **tauri.conf.json**
   - çª—å£å°ºå¯¸ï¼š64x64 â†’ 3000x2000
   - æ·»åŠ ï¼š`focus: false`
   - ç¦ç”¨ï¼šupdater

2. **Cargo.toml**
   - ç§»é™¤ï¼š`updater` feature
   - æ·»åŠ ï¼š`cocoa = "0.25"` (macOS only)

3. **æ–°æ–‡ä»¶ï¼šmacos_window.rs**
   ```rust
   // ä½¿ç”¨ macOS åŸç”Ÿ API è®¾ç½®çª—å£å±‚çº§
   - NSScreenSaverWindowLevel (1000)
   - NSWindowCollectionBehavior é…ç½®
   - å…è®¸åœ¨æ‰€æœ‰ç©ºé—´æ˜¾ç¤º
   - æ˜¾ç¤ºåœ¨å…¨å±åº”ç”¨ä¹‹ä¸Š
   ```

4. **main.rs**
   - ç§»é™¤ï¼š`maximize()` è°ƒç”¨
   - æ·»åŠ ï¼š`set_window_above_all()` macOS ä¸“ç”¨è®¾ç½®

5. **utils.rs**
   - ç§»é™¤ï¼š`maximized(true)`
   - æ·»åŠ ï¼š`inner_size(3000.0, 2000.0)`
   - æ·»åŠ ï¼š`position(0.0, 0.0)`
   - æ·»åŠ ï¼š`focused(false)`

### å‰ç«¯ä»£ç 

**PhaserWrapper.tsx**
- å·²ä½¿ç”¨ `window.screen.width/height`
- è‡ªåŠ¨é€‚é…å±å¹•å°ºå¯¸
- å® ç‰©æ´»åŠ¨èŒƒå›´ = å®é™…å±å¹•å¤§å°

**Pets.ts**
- å·²è®¾ç½®ç‰©ç†ä¸–ç•Œè¾¹ç•Œ
- å·²å¯ç”¨ç¢°æ’æ£€æµ‹

## ğŸ¯ æœ€ç»ˆæ•ˆæœ

- âœ… å® ç‰©å§‹ç»ˆæ˜¾ç¤ºåœ¨**æ‰€æœ‰çª—å£ä¹‹ä¸Š**
- âœ… åŒ…æ‹¬ Chromeã€Safariã€å¯åŠ¨å°
- âœ… åŒ…æ‹¬å…¨å±åº”ç”¨
- âœ… ä¸è¢«ä»»åŠ¡æ ï¼ˆDockï¼‰é®æŒ¡
- âœ… çª—å£é€æ˜å¯ç‚¹å‡»ç©¿é€
- âœ… ä¸æŠ¢å¤ºç„¦ç‚¹

## âš ï¸ å·²çŸ¥é—®é¢˜

### å® ç‰©è·‘å‡ºå±å¹•è¾¹ç•Œ

**å¯èƒ½åŸå› ï¼š**
1. Phaser çš„ç‰©ç†è¾¹ç•Œè®¡ç®—æœ‰è¯¯å·®
2. DPI ç¼©æ”¾é—®é¢˜ï¼ˆRetina æ˜¾ç¤ºå±ï¼‰
3. å±å¹•å°ºå¯¸è·å–ä¸å‡†ç¡®

**åç»­ä¿®å¤æ–¹æ¡ˆï¼ˆå¦‚æœéœ€è¦ï¼‰ï¼š**

#### æ–¹æ¡ˆ Aï¼šæ·»åŠ é¢å¤–çš„è¾¹ç•Œæ£€æŸ¥
```typescript
// åœ¨ Pets.ts update() ä¸­æ·»åŠ 
update() {
    this.pets.forEach(pet => {
        // å¼ºåˆ¶é™åˆ¶å® ç‰©ä½ç½®
        const margin = 50; // ç•™å‡ºè¾¹ç•Œ
        if (pet.x < margin) pet.x = margin;
        if (pet.x > window.screen.width - margin) {
            pet.x = window.screen.width - margin;
        }
        if (pet.y < margin) pet.y = margin;
        if (pet.y > window.screen.height - margin) {
            pet.y = window.screen.height - margin;
        }
    });
}
```

#### æ–¹æ¡ˆ Bï¼šä½¿ç”¨ window.devicePixelRatio è°ƒæ•´
```typescript
// è€ƒè™‘ Retina å±å¹•çš„åƒç´ æ¯”
const actualWidth = window.screen.width / window.devicePixelRatio;
const actualHeight = window.screen.height / window.devicePixelRatio;
```

## ğŸ“¦ æ„å»ºæ­¥éª¤

1. **æ¨é€ä»£ç **ï¼ˆå·²å®Œæˆï¼‰
   ```bash
   git push origin main
   ```

2. **è§¦å‘ GitHub Actions**
   - è®¿é—® GitHub Actions é¡µé¢
   - è¿è¡Œ "Simple Build macOS M2"
   - ç­‰å¾… 15-20 åˆ†é’Ÿ

3. **ä¸‹è½½å®‰è£…**
   - ä¸‹è½½ Artifacts ä¸­çš„ DMG
   - ä¼ åˆ° MacBook
   - å®‰è£…å¹¶æµ‹è¯•

## ğŸ§ª æµ‹è¯•æ¸…å•

å®‰è£…æ–°ç‰ˆæœ¬åæµ‹è¯•ï¼š

- [ ] åº”ç”¨èƒ½æ­£å¸¸å¯åŠ¨
- [ ] èœå•æ å›¾æ ‡å¯è§
- [ ] èƒ½æ‰“å¼€ Setting çª—å£
- [ ] èƒ½æ·»åŠ  Corgi å® ç‰©
- [ ] **å® ç‰©åœ¨ Chrome ä¹‹ä¸Šæ˜¾ç¤º**
- [ ] **å® ç‰©åœ¨ Safari ä¹‹ä¸Šæ˜¾ç¤º**
- [ ] **å® ç‰©åœ¨å¯åŠ¨å°ä¹‹ä¸Šæ˜¾ç¤º**
- [ ] å® ç‰©ä¸ä¼šå®Œå…¨è·‘å‡ºå±å¹•å·¦å³è¾¹ç•Œ
- [ ] ç‚¹å‡»ç©¿é€åŠŸèƒ½æ­£å¸¸
- [ ] ä¸æŠ¢å¤ºå…¶ä»–çª—å£ç„¦ç‚¹

## ğŸ”„ å¦‚æœè¿˜æœ‰é—®é¢˜

### å® ç‰©ä»è¢«é®æŒ¡
å¯èƒ½éœ€è¦æ›´é«˜çš„çª—å£å±‚çº§ã€‚è€ƒè™‘ï¼š
- `NSPopUpMenuWindowLevel` (101)
- `NSStatusWindowLevel` (25)

### å® ç‰©è·‘å‡ºå±å¹•
éœ€è¦åœ¨å‰ç«¯æ·»åŠ é¢å¤–çš„ä½ç½®é™åˆ¶ä»£ç ã€‚

### å…¶ä»–é—®é¢˜
æˆªå›¾ + æè¿°å…·ä½“æƒ…å†µï¼Œç»§ç»­è°ƒè¯•ã€‚

## ğŸ“ æ–‡ä»¶æ¸…å•

ä¿®æ”¹çš„æ–‡ä»¶ï¼š
- `src-tauri/tauri.conf.json`
- `src-tauri/Cargo.toml`
- `src-tauri/src/main.rs`
- `src-tauri/src/app/utils.rs`
- `src-tauri/src/app/mod.rs`
- `src-tauri/src/app/macos_window.rs`ï¼ˆæ–°å»ºï¼‰
- `.github/workflows/build-simple.yml`ï¼ˆæ–°å»ºï¼‰

æ„å»ºé…ç½®ï¼š
- GitHub Actions è‡ªåŠ¨æ„å»º
- ç›®æ ‡ï¼šaarch64-apple-darwin (M2)
- äº§ç‰©ï¼šDMG å®‰è£…åŒ…

---

é‡æ–°æ„å»ºåï¼Œåº”è¯¥èƒ½è§£å†³å¤§éƒ¨åˆ†é—®é¢˜ï¼å¦‚æœå® ç‰©è¿˜æ˜¯è·‘å‡ºå±å¹•ï¼Œæˆ‘ä»¬å¯ä»¥å†è°ƒæ•´å‰ç«¯ä»£ç ã€‚ğŸš€
